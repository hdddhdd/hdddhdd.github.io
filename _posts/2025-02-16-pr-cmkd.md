---
layout: post
title: "[ë…¼ë¬¸ ë¦¬ë·°] Cross-Modality Knowledge Distillation Network forÂ Monocular 3D Object Detection(ECCV 2022)"
subtitle: Cross-Modality Â· Knowledge Distillation Â· Monocular 3D Object Detection
gh-repo: Cc-Hy/CMKD
gh-badge: [star, fork, follow]
tags: [Cross-Modality, Monocular 3D Object Detection, Knowledge Distillation]
comments: true
mathjax: true
author: Heejung Choi
---

{: .box-success}
**ë…¼ë¬¸ ìš”ì•½**: ë³¸ ë…¼ë¬¸ì—ì„œëŠ” LiDAR ê¸°ë°˜ íƒì§€ê¸°ì˜ ì§€ì‹ì„ ë‹¨ì¼ ì¹´ë©”ë¼(ë‹¨ì•ˆ) ê¸°ë°˜ íƒì§€ê¸°ë¡œ íš¨ê³¼ì ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ìƒˆë¡œìš´ ì§€ì‹ ì¦ë¥˜ ë°©ë²•ì„ ì œì•ˆí•¨.

## ì—°êµ¬ ë°°ê²½
- 3D ê°ì²´ íƒì§€ëŠ” ì¦ê°• í˜„ì‹¤, ë¡œë´‡ ê³µí•™, ììœ¨ì£¼í–‰ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í•µì‹¬ ê¸°ìˆ ë¡œ í™œìš©ë˜ë©°, ë‹¨ì•ˆ ì¹´ë©”ë¼ ê¸°ë°˜ íƒì§€ëŠ” ì €ë¹„ìš©Â·ê³ í•´ìƒë„ ë°ì´í„° íšë“ì´ ê°€ëŠ¥í•˜ì—¬ ì£¼ëª©ë°›ê³  ìˆìŒ.
- ê·¸ëŸ¬ë‚˜ ë‹¨ì•ˆ ì¹´ë©”ë¼ ê¸°ë°˜ 3D íƒì§€ëŠ” LiDAR ê¸°ë°˜ íƒì§€ë³´ë‹¤ 3D ì •ë³´ê°€ ë¶€ì¡±í•˜ì—¬ ì„±ëŠ¥ ì°¨ì´ê°€ í¼, íŠ¹íˆ ê¹Šì´ ì •ë³´ê°€ ë¶€ì¡±í•˜ì—¬ ì •í™•í•œ íƒì§€ê°€ ì–´ë ¤ì›€.
- ê¸°ì¡´ ì—°êµ¬ì—ì„œëŠ” Pseudo-LiDAR ê¸°ë²•ì„ í™œìš©í•´ ë‹¨ì•ˆ ì´ë¯¸ì§€ë¥¼ 3D ì êµ°ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ì‹ì´ ë“±ì¥í–ˆìœ¼ë‚˜, ì—¬ì „íˆ LiDAR ë°ì´í„°ì˜ ê³ ìœ í•œ ì •ë³´ë¥¼ ì¶©ë¶„íˆ í™œìš©í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ìˆìŒ.

## ì—°êµ¬ì˜ í•„ìš”ì„±
- ê¸°ì¡´ì˜ Pseudo-LiDAR ë°©ì‹ì€ ë‹¨ìˆœíˆ depth mapì„ ìƒì„±í•˜ëŠ” ë°©ì‹ì— ê·¸ì³, LiDAR ë°ì´í„°ì˜ ê³ ì°¨ì› íŠ¹ì§•(feature) ì •ë³´ë¥¼ ì¶©ë¶„íˆ í•™ìŠµí•˜ì§€ ëª»í•¨.
- ë˜í•œ ê¸°ì¡´ ë°©ë²•ë“¤ì€ ë¹„íš¨ìœ¨ì ì¸ í•™ìŠµ ì „ëµì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ ìµœì í™”ê°€ ì–´ë ¤ì› ìŒ.
- ë³¸ ì—°êµ¬ì—ì„œëŠ” LiDAR íƒì§€ê¸°ì˜ ì •ë³´ë¥¼ ë‹¨ì•ˆ íƒì§€ê¸°ì— ì§ì ‘ì ìœ¼ë¡œ transferí•˜ëŠ” Cross-Modality Knowledge Distillation(CMKD) ê¸°ë²•ì„ ì œì•ˆí•˜ì—¬, LiDAR ê¸°ë°˜ íƒì§€ê¸°ì˜ íŠ¹ì§•ê³¼ ì‘ë‹µ ì •ë³´ë¥¼ ë‹¨ì•ˆ íƒì§€ê¸°ì— íš¨ìœ¨ì ìœ¼ë¡œ í•™ìŠµì‹œí‚´.
- ë¼ë²¨ë§ë˜ì§€ ì•Šì€ ëŒ€ê·œëª¨ ë°ì´í„°ë¥¼ í™œìš©í•œ ë°˜ì§€ë„ í•™ìŠµ ê¸°ë²•ì„ ì ìš©í•˜ì—¬ ë¼ë²¨ë§ ë¹„ìš©ì„ ì¤„ì´ë©´ì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚´.


## ì—°êµ¬ ë°©ë²•ë¡ 
### 3.1 Framework Overview
![cmkd-fig3](/assets/img/cmkd/cmkd-fig3.png)
### ğŸ’¡ Training
- monocular imageì™€ í•´ë‹¹í•˜ëŠ” LiDAR í¬ì¸íŠ¸ë¥¼ ì…ë ¥ ìŒìœ¼ë¡œ ì‚¬ìš©
- Teacher ëª¨ë¸: ì‚¬ì „ í•™ìŠµëœ Teacher ëª¨ë¸ì€ LiDAR í¬ì¸íŠ¸ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ BEV feature mapë¥¼ ìƒì„±í•¨. BEV feature mapì€ LiDAR í¬ì¸íŠ¸ì—ì„œ ì •í™•í•œ 3D informationì„ ê³„ìŠ¹í•˜ë©°, feature guidanceë¡œ ì‚¬ìš©ë¨. ë˜í•œ, Teacher ëª¨ë¸ì€ 3D ë°”ìš´ë”©ë°•ìŠ¤, ê°ì²´ í´ë˜ìŠ¤, confidence scoreë¥¼ í¬í•¨í•œ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ response guideë¡œ ì œê³µí•¨.
- Student ëª¨ë¸: í•™ìŠµ ê°€ëŠ¥í•œ student ëª¨ë¸ì€ monocular imageë¡œë¶€í„° BEV feature mapê³¼ 3D ê°ì²´ íƒì§€ ê²°ê³¼ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•™ìŠµë˜ë©°, ìœ ìš©í•œ ì§€ì‹ì„ ì „ì´ë°›ê¸° ìœ„í•´ Teacher ëª¨ë¸ì´ ì œê³µí•˜ëŠ” feature levelê³¼ response levelì˜ soft guidanceë¥¼ í™œìš©í•¨.

### ğŸ’¡ Inference
- Inference ë‹¨ê³„ì—ì„œëŠ” student ëª¨ë¸ë§Œ ì‚¬ìš©í•´ì„œ monocular imageë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ 3D ê°ì²´ íƒì§€ë¥¼ ìˆ˜í–‰í•¨. 

### 3.2 BEV Feature Learning
![cmkd-fig3](/assets/img/cmkd/cmkd-fig3.png)
(a) LiDAR-Based Branch
- LiDAR-based teacher model: SECOND
1) ì…ë ¥ëœ LiDAR í¬ì¸íŠ¸ë¥¼ 3D voxelë¡œ ë¶„í• í•˜ê³ , ì´ë¥¼ voxel backboneì— ì „ë‹¬í•˜ì—¬ voxel feature ì¶”ì¶œ
2) voxel featureë¥¼ ë†’ì´ ì°¨ì› (Z)ìœ¼ë¡œ stackí•˜ì—¬ LiDAR BEV feature mapìœ¼ë¡œ ë³€í™˜
3) Teacher ëª¨ë¸ì˜ í•™ìŠµ ë‹¨ê³„ì—ì„œëŠ” ì›ë˜ì˜ one-hot label ëŒ€ì‹ , Quality Focal Lossë¥¼ ì‚¬ìš©í•´ì„œ IoUë¥¼ ì—°ì†ì ì¸ í’ˆì§ˆ Labelë¡œ í™œìš©í•¨. ì‹ ë¢° ì ìˆ˜ë¥¼ IoU ê¸°ë°˜ìœ¼ë¡œ ì˜ˆì¸¡í•˜ë„ë¡ í•™ìŠµ


(b) Image-based Branch 
- Image-based Student model: CaDDN
1) ì…ë ¥ëœ ì´ë¯¸ì§€ I ì—ì„œ Image Backbone(ex. ResNet)ì„ ì‚¬ìš©í•´ image featureë¥¼ ì¶”ì¶œ
2) depth distribution estimation network(ex. DeepLabV3)ë¥¼ ì‚¬ìš©í•´ í”½ì…€ ë‹¨ìœ„ì˜ depth distribution ì˜ˆì¸¡
3) image featureì™€ depth distributionì„ ê²°í•©í•˜ì—¬ frustum grid ğºë¥¼ ìƒì„±
4) frustum volumeì„ calibration ë§¤ê°œë³€ìˆ˜ë¡œ ë³´ê°„í•˜ì—¬ LiDAR ì¢Œí‘œì˜ ì§ìœ¡ë©´ì²´ volumeìœ¼ë¡œ ë³€í™˜
5) voxel featureë¥¼ ì¶•ì†Œí•˜ê³ , ì±„ë„ ì••ì¶• ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ìµœì¢… image bev feature map ìƒì„±

### 3.3 Domain Adaptation via Self-calibration
![cmkd-fig2](/assets/img/cmkd/cmkd-fig2.png)
- LiDAR BEV featureì™€ Image BEV featureëŠ” ì„œë¡œ ë‹¤ë¥¸ ì…ë ¥ ëª¨ë‹¬ë¦¬í‹°ì™€ ë°±ë³¸ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì—, ê³µê°„ì  ë° ì±„ë„ì  feature ë¶„í¬ì—ì„œ ì°¨ì´ë¥¼ ë³´ì„.
- ë‘˜ì˜ ì°¨ì´ë¥¼ ì¤„ì´ê³ , ë™ì‹œì— Image BEV Featureë¥¼ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ domain adaptation (DA) ëª¨ë“ˆì„ ë„ì…í•¨. 
- êµ¬ì²´ì ìœ¼ë¡œ, Image BEV Feature ë’¤ì— Self-Calibrated Block 5ê°œë¥¼ stackí•˜ì—¬ ê³µê°„ì  ë° ì±„ë„ì  ë³€í™˜ì„ ì ìš©í•¨.

### 3.4 Feature-Based Knowledge Distillation
![cmkd-etc](/assets/img/cmkd/cmkd-etc.png)
- LiDAR BEV featureë¥¼ Image BEV featureì˜ ì¤‘ê°„ ê³ ì°¨ì›ì˜ feature distillation guidanceë¡œ ì‚¬ìš©í•¨. 
- feature distillation lossëŠ” MSEë¥¼ ì‚¬ìš©í•˜ì—¬ ê³„ì‚°í•¨.


![cmkd-fig5](/assets/img/cmkd/cmkd-fig5.png)
$BEV_{Image}$: ì´ë¯¸ì§€ ê¸°ë°˜ BEV feature, ê¹Šì´ ì •ë³´ì— ì˜ì¡´í•´ì„œ êµ¬ì„±í•œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œì´ê¸° ë•Œë¬¸ì—, ê°ì²´ ìœ¤ê³½ì´ ëšœë ·í•˜ì§€ ì•ŠìŒ.

+ $L_{feat}$: feature distillation lossë¥¼ ì ìš©í•´ì„œ LiDAR BEV featureì—ì„œ íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬ ê°ì²´ ìœ¤ê³½ì´ ì¼ë¶€ ê°•ì¡°ë¨.
+ $ğ·ğ´$: Domain adaptationì„ í†µí•´ ì´ë¯¸ì§€ BEV featureê°€ LiDAR BEV featureì™€ ë” ìœ ì‚¬í•´ì§€ê²Œë¨. 
$BEV_{LiDAR}$: LiDAR ê¸°ë°˜ BEV feature, ì •í™•í•œ 3D ì •ë³´ë¥¼ í¬í•¨í•¨.

### 3.5 Response-Based Knowledge Distillation
- teacher ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°ê³¼ í˜•íƒœ: soft label
- teacher ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ student ëª¨ë¸ì˜ response guidanceë¡œ í™œìš©
- Quality-Aware Distillation: 

![cmkd-fig6](/assets/img/cmkd/cmkd-fig6.png)
![cmkd-etc2](/assets/img/cmkd/cmkd-etc2.png)

### 3.6 Loss Function
![cmkd-lossfun](/assets/img/cmkd/cmkd-lossfun.png)

### 3.7 Extension: Distilling Unlabeled Data
- ê¸°ì¡´ì˜ ë‹¨ì¼ ì¹´ë©”ë¼ ê¸°ë°˜ 3D íƒì§€ ë°©ë²• (ex. Pseudo-LiDAR)ë“¤ì€ ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ë¥¼ ì£¼ë¡œ ê¹Šì´ ì •ë³´ë¥¼ í•™ìŠµí•˜ëŠ” ë°ë§Œ ì‚¬ìš©í•¨. 
- CMKDì—ì„œëŠ” ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ë¥¼ ë‹¨ìˆœíˆ ê¹Šì´ í•™ìŠµì—ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì „ì²´ ë„¤íŠ¸ì›Œí¬ë¥¼ ìµœì í™”í•˜ëŠ”ë° í™œìš©í•¨. 
  1) Teacher ëª¨ë¸ì´ ë¼ë²¨ì´ ìˆëŠ” ì†Œìˆ˜ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ ë¨¼ì € í•™ìŠµ
  2) ì´í›„ Teacher ëª¨ë¸ì´ ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ì—ì„œ ìœ ìš©í•œ ì •ë³´(soft guidance)ë¥¼ ì¶”ì¶œ
  3) Teacherì˜ soft guidanceë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ë¥¼ í™œìš©í•´ student ëª¨ë¸ì„ í•™ìŠµ

- ë¼ë²¨ë§ ë¹„ìš© ì ˆê°, Teacher ëª¨ë¸ì´ ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•´ì„œ student ëª¨ë¸ì´ ë” ì¢‹ì€ ì„±ëŠ¥ì„ ë°œíœ˜í•˜ë„ë¡ ë„ì›€.

  

## ì—°êµ¬ ê²°ê³¼ ë° í•´ì„
![cmkd-tab1](/assets/img/cmkd/cmkd-tab1.png)
![cmkd-tab2](/assets/img/cmkd/cmkd-tab2.png)

- CMKD: trained with the official training set KITTI trainval (~7.5k) for 80epochs
- CMKD*: trained with the unlabeled KITTI Raw (~42k) for 30 epochs

![cmkd-tab3](/assets/img/cmkd/cmkd-tab3.png)

### Ablation Study
1. Effectiveness of Both Distillation
![cmkd-tab4](/assets/img/cmkd/cmkd-tab4.png)


2. Effectiveness of Distilling Unlabeled Data
![cmkd-tab56](/assets/img/cmkd/cmkd-tab56.png)


## ê²°ë¡ 
- LiDAR ëª¨ë‹¬ë¦¬í‹°ì˜ ì§€ì‹ì„ ì´ë¯¸ì§€ ëª¨ë‹¬ë¦¬í‹°ë¡œ ì „ì´í•˜ì—¬ ë‹¨ì¼ ì¹´ë©”ë¼ 3D íƒì§€ ì •í™•ë„ í¬ê²Œ í–¥ìƒ
ë¼ë²¨ ì—†ëŠ” ë°ì´í„°ë¥¼ í™œìš©í•œ semi-supervised learning frameworkë¡œ í™•ì¥í•˜ì—¬ ì„±ëŠ¥ í–¥ìƒ ë° ë¼ë²¨ë§ ë¹„ìš© ì ˆê°
- KITTI, Waymo ë²¤ì¹˜ë§ˆí¬ì—ì„œ SOTA ë‹¬ì„±
- CMKDëŠ” ë‹¨ì¼ ì¹´ë©”ë¼ 3D íƒì§€ì— ìƒˆë¡œìš´ ê´€ì ì„ ì œì‹œí•˜ë©°, ì‹¤ì œ í™˜ê²½ì—ì„œ ë¼ë²¨ ì—†ëŠ” ë°ì´í„° í™œìš© ê°€ëŠ¥ì„±ì„ ì…ì¦



{: .box-note}
**Note:** LiDAR ë°ì´í„°ì˜ ê²½ìš°, íŠ¹íˆ ë¼ë²¨ë§í•˜ê¸° ì–´ë ¤ìš´ë°, ì´ëŸ° ë¼ë²¨ì—†ëŠ” ëŒ€ê·œëª¨ì˜ LiDAR ë°ì´í„°ì…‹ì„ í™œìš©í•´ì„œ ì„±ëŠ¥ì„ ë†’ì´ëŠ” ë¶€ë¶„ì´ ì‹¤ì œë¡œë„ ë„ì›€ì´ ë§ì´ ë  ê²ƒ ê°™ìŒ. 
BEV featureëŠ” ì›ë˜ LiDAR ë°ì´í„°ì—ì„œ ì‚¬ìš©ë˜ëŠ” featureì¸ë°, image-based student ëª¨ë¸ì—ì„œ depth distribution ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì…ì²´ì ì¸ frustum gridì˜ featureë¥¼ ë§Œë“¤ê³  BEV featureì™€ ìœ ì‚¬í•˜ê²Œ ë§Œë“œëŠ” ê³¼ì •ì´ ìƒˆë¡œì› ìŒ. 

